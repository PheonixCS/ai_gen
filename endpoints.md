# API Endpoints Documentation

This document provides a comprehensive list of all API endpoints used by the frontend in the IMAGENI project. All endpoints are configured in `config/endpoints-config.ts` for centralized management.

## Configuration Structure

The endpoints are organized in a structured configuration:

```typescript
endpointsConfig = {
  auth: {
    login: '...',
    register: '...',
    resetPassword: '...',
    proxy: {
      login: '...',
      register: '...',
      resetPassword: '...',
    }
  },
  imageGeneration: {
    generate: '...',
    userImages: '...',
    legacyGenerate: '...',
    proxy: {
      generate: '...',
      userImages: '...'
    }
  },
  payment: {
    process: '...',
    proxy: {
      process: '...'
    }
  }
}
```

## Authentication Endpoints

### Login
- **Path**: `endpointsConfig.auth.login` (`/api_log.php`)
- **Method**: GET
- **Proxy Path**: `endpointsConfig.auth.proxy.login` (`/api/auth/login`)
- **Proxy Method**: POST
- **Parameters**:
  - `em`: Email (URL encoded)
  - `pass`: Password (URL encoded)
- **Response**:
  ```json
  {
    "log": "success|error",
    "msg": "message text",
    "user_id": 123,
    "sub": "y|n",
    "timestamp": 1234567890,
    "code": 200,
    "verify": 0
  }
  ```
- **Description**: Authenticates a user and returns session information including subscription status.

### Register
- **Path**: `endpointsConfig.auth.register` (`/api_reg.php`)
- **Method**: GET
- **Proxy Path**: `endpointsConfig.auth.proxy.register` (`/api/auth/register`)
- **Proxy Method**: POST
- **Parameters**:
  - `em`: Email (URL encoded)
  - `pass`: Password (URL encoded)
- **Response**:
  ```json
  {
    "code": 200,
    "msg": "message text",
    "log": "success|error",
    "user_id": 123
  }
  ```
- **Description**: Registers a new user account.

### Reset Password
- **Path**: `endpointsConfig.auth.resetPassword` (`/api_reset.php`)
- **Method**: GET
- **Proxy Path**: `endpointsConfig.auth.proxy.resetPassword` (`/api/auth/reset-password`)
- **Proxy Method**: POST
- **Parameters**:
  - Request reset:
    - `em`: Email (URL encoded)
  - Verify code:
    - `em`: Email (URL encoded)
    - `check_code`: Verification code (URL encoded)
  - Change password:
    - `em`: Email (URL encoded)
    - `change_code`: Verification code (URL encoded)
    - `pass`: New password (URL encoded)
- **Response**:
  ```json
  {
    "code": 200,
    "msg": "message text"
  }
  ```
- **Description**: Handles password reset workflow in three steps: request reset, verify code, and change password.

## Image Generation Endpoints

### Generate Image
- **Path**: `endpointsConfig.imageGeneration.generate` (`/api_generate.php`)
- **Method**: POST
- **Proxy Path**: `endpointsConfig.imageGeneration.proxy.generate` (`/imageni_clean/api_generate.php`)
- **Proxy Method**: POST
- **Request Body**:
  ```json
  {
    "prompt": "description of the image",
    "style_preset": "optional style preset",
    "output_format": "png",
    "em": "user email",
    "pass": "user password",
    "uid": "optional user id"
  }
  ```
- **Response**:
  ```json
  {
    "image_url": "url to generated image"
  }
  ```
- **Description**: Generates an AI image based on the provided prompt and style settings.

### User Images
- **Path**: `endpointsConfig.imageGeneration.userImages` (`/api_img.php`)
- **Method**: POST
- **Proxy Path**: `endpointsConfig.imageGeneration.proxy.userImages` (`/api/user-images`)
- **Proxy Method**: POST
- **Request Body**:
  ```json
  {
    "em": "user email",
    "pass": "user password",
    "action": "list"
  }
  ```
- **Response**:
  ```json
  {
    "status": "ok|error",
    "images": [
      {
        "id": "image_id",
        "url": "image_url",
        "prompt": "image prompt",
        "date": "creation date"
      }
    ],
    "message": "status message",
    "code": 200
  }
  ```
- **Description**: Retrieves a list of all images generated by a user.

### Fetch Images (Legacy API)
- **Path**: `endpointsConfig.imageGeneration.legacyGenerate` (`/imageni_clean/api_img.php`)
- **Method**: POST
- **Parameters**: FormData containing:
  - `em`: User email
  - `pass`: User password
  - `text`: Prompt for image generation
  - `style`: Style preset
  - `img`: Image ID (0 for new image)
  - `size`: Image aspect ratio as "AxB" (e.g. "1x1", "4x3")
  - `uid`: Optional user ID
- **Response**:
  ```json
  {
    "log": "success|error",
    "msg": "status message",
    "code": 200,
    "user_id": 123,
    "timestamp": 1234567890,
    "email": "user@example.com",
    "pass": "password",
    "sub": "y|n",
    "usage_7d": 10,
    "images": ["array of image objects"],
    "answer": {}
  }
  ```
- **Description**: Legacy API for image generation and retrieval.

## Payment Endpoints

### Payment API
- **Path**: `endpointsConfig.payment.process` (`/api_pay.php`)
- **Method**: POST
- **Proxy Path**: `endpointsConfig.payment.proxy.process` (`/api/payment`)
- **Parameters**: (Requires further documentation)
- **Description**: Handles payment processing for subscription purchases.

## General Notes

1. **Configuration Management**:
   - All endpoints are centrally configured in `config/endpoints-config.ts`
   - This allows for easy changes to endpoint paths across the application

2. **Proxy Endpoints**:
   - The application uses Next.js API routes as proxies to avoid CORS issues in browser environments
   - These proxy paths begin with `/api/` and are also configured in the endpoints configuration

3. **Authentication**:
   - Most endpoints require email and password for authentication
   - No token-based authentication is currently implemented

4. **Environment Handling**:
   - The application can be configured to use relative paths or absolute URLs
   - Development mode typically uses proxy routes
   - Production can be configured to use direct API calls
